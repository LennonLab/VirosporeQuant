---
title: "Phage_OSG"
author: "Joy O'Brien"
date: "2025-03-07"
output: html_document
---

```{r setup, include=FALSE}
# Load OSG data
library(readxl)
OSG <- read_excel("~/GitHub/VirosporeQuant/Phage_OSG/Data/20250305_1447_OSG_spo1.xlsx", sheet = "SPO1_OSG")

```

```{r}
# Visualize
library(ggplot2)
ggplot(OSG, aes(x = Time.min, y = SPO1.titer_PFU_mL)) +
  geom_point() +
  geom_line() +
  scale_y_log10() +  # Log scale often helps with phage data
  labs(x = "Time (min)", y = "Phage Concentration (PFU/mL)", 
       title = "Phage One-Step Growth Curve") +
  theme_minimal()
```
```{r}
# Renaming time column because I dont think that gcplyer likes "." in column names
library(dplyr)
OSG <- OSG %>%
  rename(
    Time = Time.min
  )
# Working with gcplyr package 
library(gcplyr)
library(dplyr)

# Smooth the data
OSG <- OSG %>%
  mutate(Smoothed_Phage = smooth_data(x = Time, y = SPO1.titer_PFU_mL, 
                                      sm_method = "loess", window_width_n = 5))

```
```{r}
# Calculate derivatives
OSG <- OSG %>%
  mutate(Deriv_Phage = calc_deriv(x = Time, y = Smoothed_Phage, 
                                  percapita = TRUE, blank = 0, 
                                  window_width_n = 5))
```

```{r}
# Extract parms
latent_period <- OSG %>%
  filter(Deriv_Phage > 0.1 * max(Deriv_Phage, na.rm = TRUE)) %>%
  summarise(Latent = min(Time)) %>%
  pull(Latent)
```

```{r}
burst_size <- max(OSG$Smoothed_Phage) / min(OSG$Smoothed_Phage)

# Print results
cat("Latent Period:", latent_period, "min\n")
cat("Burst Size:", burst_size, "\n")
```

```{r}
# Plot
ggplot(OSG, aes(x = Time)) +
  geom_point(aes(y = SPO1.titer_PFU_mL), color = "black", alpha = 0.5) +
  geom_smooth(aes(y = Smoothed_Phage), color = "blue") +
  geom_vline(xintercept = latent_period, linetype = "dashed", color = "red") +
  scale_y_log10() +
  labs(x = "Time (min)", y = "Phage Concentration (PFU/mL)", 
       title = "") +
  scale_color_manual() +
  theme_minimal() +

```
```{r}
ggplot(OSG, aes(x = Time)) +
  geom_point(aes(y = SPO1.titer_PFU_mL, color = "Observed"), alpha = 0.5) +
  geom_smooth(aes(y = Smoothed_Phage, color = "Smoothed")) +
  geom_vline(aes(xintercept = latent_period, color = "Latent period"), linetype = "dashed") +
  scale_y_log10() +
  labs(x = "Time (min)", y = "Phage Concentration (PFU/mL)", 
       title = "", color = "") +
  scale_color_manual(values = c("Observed" = "black", 
                                "Smoothed" = "blue", 
                                "Latent period" = "red")) +
  theme_classic() +
  theme(
    plot.title = element_text(size = 12),   # Title size
    axis.title = element_text(size = 14),                 # Axis labels size
    axis.text = element_text(size = 14),                  # Tick mark labels size
    legend.title = element_text(size = 14),               # Legend title size
    legend.text = element_text(size = 14)                 # Legend labels size
  )


```

```{r}
library(ggplot2)

ggplot(OSG, aes(x = Time)) +
  geom_point(aes(y = SPO1.titer_PFU_mL), color = "black", alpha = 0.5) +
  geom_smooth(aes(y = Smoothed_Phage), color = "blue") +
  geom_vline(xintercept = latent_period, linetype = "dashed", color = "red") +
  scale_y_log10() +
  labs(
    x = "Time (min)", 
    y = "Phage Concentration (PFU/mL)", 
    title = ""
  ) +
  # Remove or customize this line only if you're mapping a variable to color in aes()
  # scale_color_manual(values = c("some_category" = "blue", ...)) 
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12)
  )

```

